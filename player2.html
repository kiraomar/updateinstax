<!DOCTYPE html>
<html dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="no-referrer">
<title>Video Player</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body,html{
    margin:0;
    padding:0;
    background:#000;
    height:100%;
    width:100%;
    overflow:hidden;
    font-family:sans-serif;
}
#container{
    position:relative;
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
}
video{
    width:100%;
    height:100%;
    object-fit:contain;
    background:black;
}
#loading{
    position:absolute;
    width:50px;
    height:50px;
    border:4px solid rgba(255,255,255,0.3);
    border-top-color:#ffc107;
    border-radius:50%;
    animation:spin 1s linear infinite;
}
@keyframes spin{
    to{transform:rotate(360deg)}
}
#error{
    position:absolute;
    color:#ff6b6b;
    background:rgba(0,0,0,0.8);
    padding:15px;
    border-radius:8px;
    display:none;
}
/* أزرار التحكم */
#controls{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:10px;
}
.control-btn{
    padding:8px 15px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-size:14px;
    color:white;
    background:#03a9f4;
}
.control-btn.fullscreen{
    background:#ff5722;
}
</style>
</head>
<body>

<div id="container">
    <div id="loading"></div>
    <div id="error">فشل تشغيل القناة</div>
    <video id="video" autoplay muted playsinline></video>
    <div id="controls">
        <button id="muteBtn" class="control-btn">كتم/إلغاء كتم</button>
        <button id="fullscreenBtn" class="control-btn fullscreen">وضع كامل</button>
    </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const streamUrl = params.get("url");

const video = document.getElementById("video");
const loading = document.getElementById("loading");
const errorBox = document.getElementById("error");

// التحكم بالصوت
const muteBtn = document.getElementById("muteBtn");
muteBtn.addEventListener('click', ()=>{
    video.muted = !video.muted;
    muteBtn.textContent = video.muted ? "إلغاء كتم" : "كتم";
});

// التحكم بالوضع الكامل
const fullscreenBtn = document.getElementById("fullscreenBtn");
fullscreenBtn.addEventListener('click', ()=>{
    if (video.requestFullscreen) video.requestFullscreen();
    else if (video.webkitEnterFullscreen) video.webkitEnterFullscreen(); // Safari
    else if (video.msRequestFullscreen) video.msRequestFullscreen();
});

function showError(){
    loading.style.display = "none";
    errorBox.style.display = "block";
}

// تحميل البث
if(!streamUrl){
    showError();
}else{
    if(Hls.isSupported()){
        const hls = new Hls({
            enableWorker:true,
            maxBufferLength:60,
            backBufferLength:90
        });
        hls.loadSource(streamUrl);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function(){
            video.play().then(()=>{
                loading.style.display="none";
            }).catch(()=>{
                video.muted = true;
                video.play();
                loading.style.display="none";
            });
        });
        hls.on(Hls.Events.ERROR, function(event,data){
            if(data.fatal){
                showError();
            }
        });
    }else if(video.canPlayType("application/vnd.apple.mpegurl")){
        video.src = streamUrl;
        video.addEventListener("loadedmetadata", ()=>{
            video.play();
            loading.style.display="none";
        });
    }else{
        showError();
    }

    // كتم تلقائي إذا تم تمرير mute=true في الرابط
    if(params.get("mute") === "true"){
        video.muted = true;
        muteBtn.textContent = "إلغاء كتم";
    }
}
</script>
</body>
</html>
